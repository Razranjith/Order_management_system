--CREATE PREDICATE FUNCTION SECOND


--CREATE ADMINISTRATOR USER ROLE
CREATE USER ADMINISTRATOR WITHOUT LOGIN;
GO

GRANT SELECT,INSERT,UPDATE,DELETE ON DBO.ORDERS TO ADMINISTRATOR;

ALTER  ROLE DB_OWNER ADD MEMBER ADMINISTRATOR;

--CHECK WHETHER ADMINISTRATOR ABLE TO SEE ALL INFO
EXECUTE AS USER ='ADMINISTRATOR'

SELECT USER_NAME()

SELECT * FROM ORDERS O JOIN ORDER_ITEMS OT ON O.Order_id=OT.Order_id;

--CREATE BUYER USER ROLE
CREATE ROLE BUYER;
GO

GRANT EXECUTE TO BUYER;

----INSERT NEW ORDER TO ORDER TABLE AND ADD NEW USER
CREATE USER ANBU WITHOUT LOGIN;
			
EXEC sp_addrolemember BUYER,ANBU ;
			
GRANT SELECT ON DBO.ORDERS TO ANBU;
			
GRANT SELECT ON DBO.ORDER_ITEMS TO ANBU;
			
GRANT SELECT ON DBO.PRODUCT TO ANBU;
			
GRANT SELECT ON DBO.ORDER_AUDIT_HISTORY TO ANBU;
			
GRANT SELECT ON DBO.ORDER_ITEMS_AUDIT_HISTORY TO ANBU;			
			
GRANT SELECT ON DBO.PRODUCT_AUDIT_HISTORY TO ANBU;
			
GRANT SELECT ON DBO.STATUS TO ANBU;

--CHECK WHETHER NEW USER ABLE TO SEE ONLY THEIR INFO

EXECUTE AS USER ='ANBU'

SELECT USER_NAME()

SELECT * FROM ORDERS O JOIN ORDER_ITEMS OT ON O.Order_id=OT.Order_id;
